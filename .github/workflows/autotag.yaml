name: Autotag

on:
  workflow_run:
    workflows: ["Deploy static content to Pages"]
    types:
      - completed

permissions:
  contents: write


jobs:
  tag:
    runs-on: ubuntu-latest

    steps:

      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Determine version bump
        id: determine_version
        run: |
          # Extract commit messages since the last tag
          git fetch --tags
          last_tag=$(git describe --tags --abbrev=0 --always)
          commits=$(git log $last_tag..HEAD --pretty=format:%s)

          # Determine the version bump based on commit messages
          if [[ $commits == *"#major"* ]]; then
            echo "::set-output name=bump::major"
          elif [[ $commits == *"#minor"* ]]; then
            echo "::set-output name=bump::minor"
          else
            echo "::set-output name=bump::patch"
          fi

      - name: Create tag
        id: create_tag
        run: |
          # Get the current version from package.json or any other source
          current_version='v1.0.0' 

          # Create the new tag
          git tag $new_version
          git push origin $new_version